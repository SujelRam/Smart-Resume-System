{% extends "base.html" %}
{% block content %}

<div class="fade-in">
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="page-title mb-0">
      <i class="bi bi-briefcase me-2" style="color: var(--primary-color);"></i>
      My Applications
    </h1>
  </div>

  <!-- Upload Section -->
  <div class="section-card mb-4">
    <h5 class="fw-bold mb-3" style="color: #191919;">
      <i class="bi bi-cloud-upload me-2" style="color: var(--primary-color);"></i>
      Upload Your Resume
    </h5>
    
    <form method="POST" enctype="multipart/form-data" id="uploadForm">
      <div class="file-upload-wrapper">
        <input type="file" name="resume" accept=".pdf" required id="resumeInput">
        <div class="upload-content">
          <i class="bi bi-cloud-arrow-up" style="font-size: 3rem; color: var(--primary-color);"></i>
          <p class="mt-2 mb-1 fw-medium" style="color: #191919;">
            Drag and drop your resume here
          </p>
          <p class="text-muted small mb-0">
            or click to browse (PDF only)
          </p>
          <p class="mt-2" id="fileName"></p>
        </div>
      </div>
      
      <div class="mt-3 text-end">
        <button type="submit" class="btn btn-primary-custom" id="uploadBtn">
          <i class="bi bi-upload me-2"></i> Submit Application
        </button>
      </div>
    </form>
  </div>

  <!-- Applications List -->
  <h5 class="fw-bold mb-3" style="color: #191919;">
    <i class="bi bi-list-task me-2" style="color: var(--primary-color);"></i>
    My Submitted Applications
  </h5>

  {% if resumes %}
  <div class="row g-4">
    {% for r in resumes %}
    <div class="col-md-6 col-lg-4">
      <div class="card-custom h-100 p-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-start mb-3">
          <div>
            <h6 class="fw-bold mb-1" style="color: #191919;">
              <i class="bi bi-file-earmark-text me-1" style="color: var(--primary-color);"></i>
              Application #{{ loop.index }}
            </h6>
            <p class="text-muted small mb-0">
              <i class="bi bi-calendar me-1"></i>
              Submitted
            </p>
          </div>
          <span class="badge-received">
            <i class="bi bi-check2-all me-1"></i>
            {{ r.status }}
          </span>
        </div>
        
        <!-- Skills -->
        {% if r.skills %}
        <div class="mb-3">
          <p class="small fw-medium mb-1" style="color: #6c757d;">
            <i class="bi bi-code-slash me-1"></i> Detected Skills:
          </p>
          <div class="d-flex flex-wrap gap-1">
            {% for skill in r.skills.split(',') %}
              {% if skill.strip() %}
              <span class="badge-skill">{{ skill.strip() }}</span>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        {% endif %}
        
        <!-- Status Message -->
        <div class="alert alert-light border-0 mb-0" role="alert">
          <i class="bi bi-info-circle me-1" style="color: var(--primary-color);"></i>
          <small>Your application has been received and is currently under review.</small>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center py-5">
    <i class="bi bi-folder2-open" style="font-size: 4rem; color: #ccc;"></i>
    <h4 class="mt-3 text-muted">No applications yet</h4>
    <p class="text-muted">Upload your resume above to get started!</p>
  </div>
  {% endif %}
</div>

<script>
  // File input display
  const resumeInput = document.getElementById('resumeInput');
  const fileName = document.getElementById('fileName');
  
  if (resumeInput) {
    resumeInput.addEventListener('change', function(e) {
      if (this.files && this.files[0]) {
        fileName.innerHTML = '<i class="bi bi-file-earmark-pdf me-1"></i><strong>' + this.files[0].name + '</strong>';
      }
    });
  }
  
  // Form submission loading
  const uploadForm = document.getElementById('uploadForm');
  const uploadBtn = document.getElementById('uploadBtn');
  if (uploadForm && uploadBtn) {
    uploadForm.addEventListener('submit', function(e) {
      uploadBtn.classList.add('btn-loading');
      uploadBtn.disabled = true;
      uploadBtn.innerHTML = '<span style="margin-right: 8px;">Uploading...</span>';
    });
  }
</script>

{% endblock %}
